import{_ as h,$ as y,d as b,A as w,a1 as x,c as N,a as t,F as I,r as L,u as o,L as f,M as T,t as c,e as S,o as _,b as M,g as R,O as H,ao as $,h as V}from"./index.d45acc52.js";import{E,u as q,f as B}from"./notebook.dc79aaf6.js";import{M as G,m as P,H as j}from"./code-style.59be7f99.js";import{E as D}from"./el-overlay.cae8fbe4.js";const p={GET:"/notes/trash",REVERT:"/notes/:noteId/revert",DELETE:"/notes/:noteId/confirm"},m={getAll(){return new Promise((s,r)=>{h(p.GET).then(a=>{a.data=a.data.sort((d,l)=>new Date(l.updatedAt).getTime()-new Date(d.updatedAt).getTime()),s(a)}).catch(a=>{r(a)})})},revertNote({noteId:s}){return h(p.REVERT.replace(":noteId",s.toString()),"PATCH")},deleteNote({noteId:s}){return h(p.DELETE.replace(":noteId",s.toString()),"DELETE")}},z=y("trash",{state:()=>({trashNotes:[],currentNote:{}}),actions:{getTrashNotes(){m.getAll().then(s=>{this.setTrashNotes(s.data)})},setTrashNotes(s){this.trashNotes=s},setCurrentNote(s){this.currentNote=s},deleteNote(s){m.deleteNote({noteId:s.id}).then(()=>{this.trashNotes=this.trashNotes.filter(r=>r.id!==s.id),this.currentNote={},E({type:"success",message:"\u5220\u9664\u6210\u529F"})})},revertNote(s){m.revertNote({noteId:s.id}).then(()=>{this.trashNotes=this.trashNotes.filter(r=>r.id!==s.id),this.currentNote={},E({type:"success",message:"\u6062\u590D\u6210\u529F"})})}}}),J={id:"trash"},O={class:"note-sidebar"},U=t("h3",null,"\u56DE\u6536\u7AD9",-1),K=t("div",{class:"menu"},[t("div",null,"\u6807\u9898"),t("div",null,"\u66F4\u65B0\u65F6\u95F4")],-1),Q={class:"notes"},W={class:"title"},X={class:"date"},Y={class:"note-detail"},Z={class:"note-detail"},tt={class:"note-empty"},et={class:"note-detail-ct"},st={class:"note-bar"},ot={class:"note-title"},ut=["value"],rt={class:"editor"},nt={placeholder:"\u8F93\u5165\u5185\u5BB9, \u652F\u6301 markdown \u8BED\u6CD5",disabled:""},at=["innerHTML"],Nt=b({__name:"TrashDetail",setup(s){const r=q();r.getNotebooks();const a=new G().use(P,{auto:!0,hljs:j}),d=S(),l=$(),e=z();e.getTrashNotes(),w.get_login_state().then(u=>{u.isLogin||d.push("/login")}),x(()=>{if(e.trashNotes&&l.query.noteId){if(e.trashNotes.length===0)return;const u=e.trashNotes.filter(i=>Number(l.query.noteId)===Number(i.id))[0];u!==void 0?e.currentNote=u:E({type:"error",message:"\u8BBF\u95EE\u7684\u7B14\u8BB0\u4E0D\u5B58\u5728"})}else e.setCurrentNote({title:"",content:""})});const F=u=>{e.setCurrentNote(u)},k=u=>{D.confirm("\u6C38\u4E45\u5220\u9664\u8BE5\u7B14\u8BB0\u5417?","\u5220\u9664\u7B14\u8BB0",{confirmButtonText:"\u786E\u8BA4",cancelButtonText:"\u53D6\u6D88",confirmButtonClass:"danger",type:"error"}).then(()=>{e.deleteNote(u),d.push("/trash")})},C=u=>{D.confirm("\u786E\u8BA4\u8981\u6062\u590D\u8BE5\u7B14\u8BB0\u5417?","\u6062\u590D\u7B14\u8BB0",{confirmButtonText:"\u6062\u590D",cancelButtonText:"\u53D6\u6D88",type:"info"}).then(()=>{e.revertNote(u),d.push("/trash")})};return(u,i)=>{var v;const A=V("router-link");return _(),N("div",J,[t("div",O,[U,K,t("ul",Q,[(_(!0),N(I,null,L(o(e).trashNotes,n=>{var g;return _(),N("li",{key:n.id},[M(A,{to:`/trash?noteId=${n.id}`,onClick:it=>F(n),class:H({active:((g=o(e).currentNote)==null?void 0:g.id)===n.id})},{default:R(()=>[t("span",W,c(n.title),1),t("span",X,c(o(B)(n.updatedAt)),1)]),_:2},1032,["to","onClick","class"])])}),128))])]),t("div",Y,[t("div",Z,[f(t("div",tt," \u8BF7\u9009\u62E9\u7B14\u8BB0 ",512),[[T,!o(e).currentNote.id]]),f(t("div",et,[t("div",st,[t("span",null," \u521B\u5EFA\u65E5\u671F: "+c(o(B)(o(e).currentNote.createdAt)),1),t("span",null," \u66F4\u65B0\u65E5\u671F: "+c(o(B)(o(e).currentNote.updatedAt)),1),t("span",null,c("\u6240\u5C5E\u7B14\u8BB0\u672C\uFF1A"+((v=o(r).getNotebookTitle(o(e).currentNote.notebookId))==null?void 0:v.title)),1),t("span",{onClick:i[0]||(i[0]=n=>k(o(e).currentNote))}," \u5F7B\u5E95\u5220\u9664 "),t("span",{onClick:i[1]||(i[1]=n=>C(o(e).currentNote))}," \u6062\u590D ")]),t("div",ot,[t("input",{type:"text",placeholder:"\u8F93\u5165\u6807\u9898",value:o(e).currentNote.title,disabled:""},null,8,ut)]),t("div",rt,[t("textarea",nt,c(o(e).currentNote.content),1),t("div",{class:"preview markdown-body",innerHTML:o(a).render(o(e).currentNote.content||"")},null,8,at)])],512),[[T,o(e).currentNote.id]])])])])}}});export{Nt as default};
